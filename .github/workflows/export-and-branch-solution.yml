name: export-and-branch-solution
on:
  workflow_dispatch:
  push:
    branches: [main]
  pull_request:
    branches: [main]
    
permissions:
    contents: write
  
jobs:
    export-from-dev:
      runs-on: windows-latest
      env: 
       runner_debug: 1
       
      steps:
      - uses: actions/checkout@v2
        with:
         lfs: true
      
      - name: who-am-i action
        uses: microsoft/powerplatform-actions/who-am-i@v0
        with:
         environment-url: 'https://org46039522.crm.dynamics.com/'
         user-name: 'j.kumar.sahoo@accenture.com'
         password-secret: ${{ secrets.password }}
         
      - name: export-solution action
        uses: microsoft/powerplatform-actions/export-solution@v0
        with:
         environment-url: 'https://org46039522.crm.dynamics.com/'
         user-name: 'j.kumar.sahoo@accenture.com'
         password-secret: ${{ secrets.password }}
         solution-name: JitenTestApp
         Solution-output-file: out/exported/JitenTestApp.zip
         
      - name: unpack-solution action
        uses: microsoft/powerplatform-actions/unpack-solution@v0
        with:
         solution-file: out/exported/JitenTestApp.zip
         solution-folder: out/solutions/JitenTestApp
         solution-type: 'unmanaged'
         overwrite-files: true
         
      - name: branch-solution, prepare it for Pull Request action
        uses: microsoft/powerplatform-actions/branch-solution@v0
        with:
          solution-folder: out/solutions/JitenTestApp
          solution-target-folder: solutions/JitenTestApp
          repo-token: ${{secrets.GITHUB_TOKEN}}
          allow-empty-commit: true
        
      
  
